<!DOCTYPE html>
<html>
<head>
    <title>Secure Payment Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow p-4 mx-auto" style="max-width: 700px;">
            <h2 class="text-center mb-4">ðŸ’³ Secure Payment Portal</h2>
            <ul class="nav nav-tabs" id="tabMenu">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#pay">Pay</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#register">Register</a></li>
            </ul>
            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="pay">
                    <div id="payResult" class="alert d-none"></div>
                    <input type="text" id="p_user_id" class="form-control mb-3" placeholder="User ID">
                    <input type="text" id="p_card_num" class="form-control mb-3" placeholder="Card Number (optional)">
                    <input type="number" id="p_amount" class="form-control mb-3" placeholder="Amount ($)">
                    <select id="p_state" class="form-control mb-3">
                        <option value="NY">New York</option>
                        <option value="CA">California</option>
                        <option value="TX">Texas</option>
                    </select>
                    <button onclick="pay()" class="btn btn-primary w-100">Pay Now</button>
                </div>

                <div class="tab-pane fade" id="register">
                    <div id="regResult" class="alert d-none"></div>
                    <input type="text" id="r_user_id" class="form-control mb-3" placeholder="User ID">
                    <input type="text" id="r_card_num" class="form-control mb-3" placeholder="Card Number">
                    <input type="text" id="r_card_cvv" class="form-control mb-3" placeholder="CVV">
                    <input type="text" id="r_card_expiry" class="form-control mb-3" placeholder="MM/YY">
                    <input type="text" id="r_state" class="form-control mb-3" placeholder="State">
                    <div class="mb-3">
                        <label class="form-label">Card Image (optional)</label>
                        <input type="file" id="r_card_image" class="form-control">
                    </div>
                    <button onclick="registerUser()" class="btn btn-success w-100">Register</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function pay() {
            const data = {
                user_id: document.getElementById('p_user_id').value,
                card_num: document.getElementById('p_card_num').value,
                amount: document.getElementById('p_amount').value,
                state: document.getElementById('p_state').value
            };

            const response = await fetch('/process_payment', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const res = await response.json();
            const alert = document.getElementById('payResult');
            alert.className = `alert d-block ${res.status === 'Approved' ? 'alert-success' : 'alert-danger'}`;
            alert.innerText = `Result: ${res.status} (${res.user_type || 'N/A'} User)`;
        }

        async function registerUser() {
            const form = new FormData();
            form.append('user_id', document.getElementById('r_user_id').value);
            form.append('card_num', document.getElementById('r_card_num').value);
            form.append('card_cvv', document.getElementById('r_card_cvv').value);
            form.append('card_expiry', document.getElementById('r_card_expiry').value);
            form.append('state', document.getElementById('r_state').value);
            const fileEl = document.getElementById('r_card_image');
            if (fileEl.files.length) form.append('card_image', fileEl.files[0]);

            const response = await fetch('/register_user', { method: 'POST', body: form });
            const res = await response.json();
            const alert = document.getElementById('regResult');
            alert.className = `alert d-block ${response.status === 200 ? 'alert-success' : 'alert-danger'}`;
            alert.innerText = JSON.stringify(res);
        }
    </script>
</body>
</html>